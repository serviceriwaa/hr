<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<title>تحليل شامل لشركة رواء - المرحلة الأولى</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  body {
    font-family: Arial, sans-serif;
    background: #f0f4f8;
    margin: 0; padding: 20px;
    color: #333;
  }
  h1 {
    text-align: center;
    color: #0a4a7b;
    margin-bottom: 20px;
  }
  form {
    max-width: 750px;
    margin: auto;
    background: #fff;
    padding: 20px 30px;
    border-radius: 10px;
    box-shadow: 0 0 15px rgba(0,0,0,0.1);
  }
  label {
    display: block;
    margin-top: 15px;
    font-weight: bold;
    position: relative;
  }
  label .tooltip {
    cursor: help;
    color: #0a4a7b;
    font-weight: normal;
    margin-right: 5px;
    border-bottom: 1px dotted #0a4a7b;
  }
  input, select {
    width: 100%;
    padding: 10px;
    margin-top: 6px;
    border: 1px solid #ccc;
    border-radius: 6px;
    font-size: 1rem;
  }
  select[multiple] {
    height: 120px;
  }
  button {
    margin-top: 25px;
    width: 100%;
    padding: 12px;
    font-size: 1.1rem;
    background: #0a4a7b;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
  }
  button:hover {
    background: #083a5d;
  }
  #result {
    max-width: 750px;
    margin: 30px auto;
    background: #e6f0ff;
    padding: 20px;
    border-radius: 10px;
    white-space: pre-line;
    font-weight: bold;
    color: #0a4a7b;
  }
  #charts_container {
    max-width: 750px;
    margin: 30px auto;
    display: flex;
    justify-content: space-around;
    flex-wrap: wrap;
    gap: 30px;
  }
  #chart_div, #pie_chart_div {
    width: 350px;
    height: 300px;
  }
  p.note {
    text-align: center;
    font-size: 0.9rem;
    color: #666;
    margin-top: 5px;
  }
  .error {
    color: red;
    font-size: 0.9rem;
    margin-top: 4px;
  }
</style>
</head>
<body>

<h1>تحليل شامل لأداء شركتك مع خطة عمل مقترحة (المرحلة الأولى)</h1>

<form id="analysisForm" novalidate>

  <label>اسم الشركة
    <span class="tooltip" title="اكتب اسم شركتك الرسمي">?</span>
  </label>
  <input type="text" id="companyName" required placeholder="مثلاً: رواء للاستشارات">
  <div id="error-companyName" class="error"></div>

  <label>الإيرادات الشهرية
    <span class="tooltip" title="إجمالي قيمة الإيرادات الشهرية التي تحققها شركتك">?</span>
  </label>
  <input type="number" id="revenue" min="0" required placeholder="مثلاً: 150000">
  <div id="error-revenue" class="error"></div>

  <label>المصاريف الشهرية
    <span class="tooltip" title="إجمالي قيمة المصاريف الشهرية التي تتحملها شركتك">?</span>
  </label>
  <input type="number" id="expenses" min="0" required placeholder="مثلاً: 120000">
  <div id="error-expenses" class="error"></div>

  <p class="note">(يرجى إدخال القيم المالية حسب العملة التي تستخدمها شركتك)</p>

  <label>عدد الموظفين
    <span class="tooltip" title="عدد الموظفين الدائمين في شركتك">?</span>
  </label>
  <input type="number" id="employees" min="1" required placeholder="مثلاً: 25">
  <div id="error-employees" class="error"></div>

  <label>متوسط عدد الموظفين الغائبين يوميًا
    <span class="tooltip" title="عدد الموظفين المتوقع غيابهم يوميًا في المتوسط">?</span>
  </label>
  <input type="number" id="avgAbsent" min="0" required placeholder="مثلاً: 3">
  <div id="error-avgAbsent" class="error"></div>

  <label>إجمالي الإنتاج الشهري (عدد الوحدات أو الخدمات)
    <span class="tooltip" title="كمية المنتجات أو الخدمات التي تقدمها شهريًا">?</span>
  </label>
  <input type="number" id="production" min="0" required placeholder="مثلاً: 500">
  <div id="error-production" class="error"></div>

  <label>عدد العملاء (اختياري)
    <span class="tooltip" title="عدد العملاء الحاليين">?</span>
  </label>
  <input type="number" id="clientsCount" min="0" placeholder="مثلاً: 200">

  <label>نقاط القوة (اختر ما ينطبق)
    <span class="tooltip" title="اختر من أهم نقاط القوة في شركتك">?</span>
  </label>
  <select id="strengths" multiple>
    <option value="خبرة عالية في الموارد البشرية">خبرة عالية في الموارد البشرية</option>
    <option value="علاقات قوية مع العملاء">علاقات قوية مع العملاء</option>
    <option value="خدمات تحليل بيانات متقدمة">خدمات تحليل بيانات متقدمة</option>
    <option value="تواجد في السوق لفترة طويلة">تواجد في السوق لفترة طويلة</option>
  </select>

  <label>نقاط الضعف (اختر ما ينطبق)
    <span class="tooltip" title="اختر من أبرز نقاط الضعف في شركتك">?</span>
  </label>
  <select id="weaknesses" multiple>
    <option value="ضعف في التسويق الرقمي">ضعف في التسويق الرقمي</option>
    <option value="نقص في التدريب للموظفين">نقص في التدريب للموظفين</option>
    <option value="اعتماد عالي على موظفين محددين">اعتماد عالي على موظفين محددين</option>
    <option value="موارد مالية محدودة">موارد مالية محدودة</option>
  </select>

  <label>الفرص (اختر ما ينطبق)
    <span class="tooltip" title="اختر من الفرص المتاحة في السوق">?</span>
  </label>
  <select id="opportunities" multiple>
    <option value="زيادة الطلب على خدمات الموارد البشرية">زيادة الطلب على خدمات الموارد البشرية</option>
    <option value="توسع السوق الرقمي">توسع السوق الرقمي</option>
    <option value="تطوير تقنيات تحليل البيانات">تطوير تقنيات تحليل البيانات</option>
    <option value="شراكات استراتيجية جديدة">شراكات استراتيجية جديدة</option>
  </select>

  <label>التهديدات (اختر ما ينطبق)
    <span class="tooltip" title="اختر من التهديدات التي تواجهها شركتك">?</span>
  </label>
  <select id="threats" multiple>
    <option value="منافسة شديدة في السوق">منافسة شديدة في السوق</option>
    <option value="تغيرات في القوانين">تغيرات في القوانين</option>
    <option value="تراجع في الاقتصاد">تراجع في الاقتصاد</option>
    <option value="صعوبة في جذب المواهب">صعوبة في جذب المواهب</option>
  </select>

  <button type="submit">ابدأ التحليل</button>
</form>

<div id="result"></div>

<div id="charts_container">
  <div id="chart_div"></div>
  <div id="pie_chart_div"></div>
</div>

<!-- Google Charts -->
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

<script>
  google.charts.load('current', {'packages':['corechart']});

  const form = document.getElementById('analysisForm');
  const resultDiv = document.getElementById('result');

  function clearErrors() {
    ['companyName','revenue','expenses','employees','avgAbsent','production'].forEach(id => {
      document.getElementById('error-' + id).innerText = '';
    });
  }

  function validate() {
    clearErrors();
    let valid = true;

    const companyName = document.getElementById('companyName').value.trim();
    const revenue = +document.getElementById('revenue').value;
    const expenses = +document.getElementById('expenses').value;
    const employees = +document.getElementById('employees').value;
    const avgAbsent = +document.getElementById('avgAbsent').value;
    const production = +document.getElementById('production').value;

    if(companyName === '') {
      document.getElementById('error-companyName').innerText = 'يرجى إدخال اسم الشركة';
      valid = false;
    }
    if(isNaN(revenue) || revenue < 0) {
      document.getElementById('error-revenue').innerText = 'يرجى إدخال إيرادات صحيحة (0 أو أكثر)';
      valid = false;
    }
    if(isNaN(expenses) || expenses < 0) {
      document.getElementById('error-expenses').innerText = 'يرجى إدخال مصاريف صحيحة (0 أو أكثر)';
      valid = false;
    }
    if(isNaN(employees) || employees < 1) {
      document.getElementById('error-employees').innerText = 'يرجى إدخال عدد موظفين صحيح (1 أو أكثر)';
      valid = false;
    }
    if(isNaN(avgAbsent) || avgAbsent < 0 || avgAbsent > employees) {
      document.getElementById('error-avgAbsent').innerText = 'يرجى إدخال غياب صحيح (0 أو أكثر وأقل من عدد الموظفين)';
      valid = false;
    }
    if(isNaN(production) || production < 0) {
      document.getElementById('error-production').innerText = 'يرجى إدخال إنتاج صحيح (0 أو أكثر)';
      valid = false;
    }

    return valid;
  }

  function getSelectedOptions(id) {
    const select = document.getElementById(id);
    return Array.from(select.selectedOptions).map(opt => opt.value);
  }

  form.addEventListener('submit', function(e) {
    e.preventDefault();

    if(!validate()) {
      resultDiv.innerText = '';
      return;
    }

    const name = document.getElementById('companyName').value.trim();
    const revenue = +document.getElementById('revenue').value;
    const expenses = +document.getElementById('expenses').value;
    const employees = +document.getElementById('employees').value;
    const avgAbsent = +document.getElementById('avgAbsent').value;
    const production = +document.getElementById('production').value;
    const clientsCountVal = document.getElementById('clientsCount').value;
    const clientsCount = clientsCountVal ? +clientsCountVal : null;

    const strengths = getSelectedOptions('strengths');
    const weaknesses = getSelectedOptions('weaknesses');
    const opportunities = getSelectedOptions('opportunities');
    const threats = getSelectedOptions('threats');

    const absenceRate = ((avgAbsent / employees) * 100).toFixed(2);
    const profit = revenue - expenses;
    const presentEmployees = employees - avgAbsent;
    const productivity = presentEmployees > 0 ? (production / presentEmployees).toFixed(2) : 0;

    // مؤشرات مالية إضافية
    const profitMargin = revenue > 0 ? ((profit / revenue) * 100).toFixed(2) : 0;
    const expenseRatio = revenue > 0 ? ((expenses / revenue) * 100).toFixed(2) : 0;
    const breakEven = expenses === 0 ? 'غير محدد' : (expenses / (profitMargin / 100)).toFixed(2);

    // حساب مؤشر الأداء KPI (0 - 100)
    let kpi = 50;
    if(profit > 0) kpi += 25; else kpi -= 15;
    if(productivity >= 10) kpi += 20; else if(productivity >= 5) kpi += 10; else kpi -= 10;
    if(absenceRate <= 5) kpi += 10; else if(absenceRate <= 10) kpi += 5; else kpi -= 20;
    if(kpi > 100) kpi = 100;
    if(kpi < 0) kpi = 0;

    // إعداد تقرير نصي
    let report = `📊 تقرير أداء شركة: ${name}\n\n`;
    report += `💰 الإيرادات الشهرية: ${revenue}\n`;
    report += `💸 المصاريف الشهرية: ${expenses}\n`;
    report += `📈 الربح/الخسارة: ${profit > 0 ? 'ربح' : 'خسارة'} بمقدار ${Math.abs(profit)}\n`;
    report += `🔹 هامش الربح: ${profitMargin}%\n`;
    report += `🔹 نسبة المصاريف للإيرادات: ${expenseRatio}%\n\n`;

    report += `👥 عدد الموظفين: ${employees}\n`;
    report += `🚶‍♂️ متوسط الغياب اليومي: ${avgAbsent} (${absenceRate}%)\n`;
    report += `🏭 إجمالي الإنتاج: ${production}\n`;
    report += `⚙️ إنتاجية الموظف الحاضر: ${productivity} وحدة/موظف\n`;
    report += `📉 نقطة التعادل (Break-even): ${breakEven}\n\n`;

    if(clientsCount !== null) {
      report += `👨‍💼 عدد العملاء: ${clientsCount}\n\n`;
    }

    report += `📋 تحليل SWOT:\n`;
    if(strengths.length) report += `✔️ نقاط القوة:\n - ${
