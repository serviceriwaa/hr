<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>تحليل شامل - شركة رواء</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f0f4f8;
      margin: 0; padding: 20px;
      color: #333;
    }
    h1 {
      text-align: center;
      color: #0a4a7b;
      margin-bottom: 20px;
    }
    form {
      max-width: 700px;
      margin: auto;
      background: #fff;
      padding: 20px 30px;
      border-radius: 10px;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
    }
    label {
      display: block;
      margin-top: 15px;
      font-weight: bold;
    }
    input, textarea {
      width: 100%;
      padding: 10px;
      margin-top: 6px;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 1rem;
    }
    button {
      margin-top: 25px;
      width: 100%;
      padding: 12px;
      font-size: 1.1rem;
      background: #0a4a7b;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
    }
    button:hover {
      background: #083a5d;
    }
    #result {
      max-width: 700px;
      margin: 30px auto;
      background: #e6f0ff;
      padding: 20px;
      border-radius: 10px;
      white-space: pre-line;
      font-weight: bold;
      color: #0a4a7b;
    }
    #map {
      width: 100%;
      height: 300px;
      margin-top: 30px;
      border-radius: 10px;
      box-shadow: 0 0 15px rgba(0,0,0,0.1);
    }
    #chart_div {
      max-width: 700px;
      margin: 30px auto;
    }
  </style>
</head>
<body>

<h1>تحليل شامل لأداء شركتك</h1>

<form id="analysisForm">

  <label>اسم الشركة</label>
  <input type="text" id="companyName" required placeholder="مثلاً: رواء للاستشارات">

  <label>موقع الشركة (المدينة)</label>
  <input type="text" id="companyLocation" required placeholder="مثلاً: الزقازيق">

  <label>الإيرادات الشهرية (بالجنيه)</label>
  <input type="number" id="revenue" required placeholder="مثلاً: 150000">

  <label>المصاريف الشهرية (بالجنيه)</label>
  <input type="number" id="expenses" required placeholder="مثلاً: 120000">

  <label>عدد الموظفين</label>
  <input type="number" id="employees" required placeholder="مثلاً: 25">

  <label>متوسط عدد الموظفين الغائبين يوميًا</label>
  <input type="number" id="avgAbsent" required placeholder="مثلاً: 3">

  <label>إجمالي الإنتاج الشهري (عدد الوحدات أو الخدمات)</label>
  <input type="number" id="production" required placeholder="مثلاً: 500">

  <label>عدد العملاء (اختياري)</label>
  <input type="number" id="clientsCount" placeholder="مثلاً: 200">

  <label>وصف مختصر للنشاط</label>
  <textarea id="activityDesc" rows="3" placeholder="مثلاً: خدمات موارد بشرية، توظيف، استشارات قانونية"></textarea>

  <button type="submit">ابدأ التحليل</button>
</form>

<div id="result"></div>

<div id="map"></div>

<div id="chart_div"></div>

<!-- Google Charts -->
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<!-- Google Maps API (ضع مفتاحك هنا) -->
<script src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_API_KEY&libraries=places"></script>

<script>
  // تحميل مكتبة Google Charts
  google.charts.load('current', {'packages':['corechart']});

  document.getElementById('analysisForm').addEventListener('submit', function(e){
    e.preventDefault();

    // قراءة البيانات
    const name = document.getElementById('companyName').value.trim();
    const location = document.getElementById('companyLocation').value.trim();
    const revenue = +document.getElementById('revenue').value;
    const expenses = +document.getElementById('expenses').value;
    const employees = +document.getElementById('employees').value;
    const avgAbsent = +document.getElementById('avgAbsent').value;
    const production = +document.getElementById('production').value;
    const clientsCount = document.getElementById('clientsCount').value ? +document.getElementById('clientsCount').value : null;
    const activityDesc = document.getElementById('activityDesc').value.trim();

    // حساب نسبة الغياب
    const absenceRate = ((avgAbsent / employees) * 100).toFixed(2);

    // حساب الربح أو الخسارة
    const profit = revenue - expenses;

    // إنتاجية الموظف الحاضر
    const presentEmployees = employees - avgAbsent;
    const productivity = presentEmployees > 0 ? (production / presentEmployees).toFixed(2) : 0;

    // تحليل SWOT بسيط تلقائي بناءً على وصف النشاط
    let strengths = [], weaknesses = [], opportunities = [], threats = [];

    if(activityDesc){
      const desc = activityDesc.toLowerCase();
      if(desc.includes('موارد بشرية') || desc.includes('توظيف')){
        strengths.push("خبرة في التوظيف وإدارة الموارد البشرية.");
        opportunities.push("ارتفاع الطلب على خدمات الموارد البشرية.");
      }
      if(desc.includes('استشارات')){
        strengths.push("خبرة في تقديم استشارات قانونية وإدارية.");
        opportunities.push("توسع السوق للخدمات الاستشارية.");
      }
      if(desc.includes('تحليل')){
        strengths.push("تقديم خدمات تحليل بيانات متقدمة.");
      }
      if(desc.includes('صغيرة') || desc.includes('متوسطة')){
        weaknesses.push("موارد محدودة نسبياً للشركات الصغيرة والمتوسطة.");
      }
      if(desc.includes('تنافس')){
        threats.push("منافسة عالية في السوق.");
      }
    } else {
      weaknesses.push("الوصف غير متوفر لتحديد نقاط القوة والضعف.");
    }

    // إعداد تقرير نصي
    let report = `📊 تقرير أداء شركة: ${name}\n\n`;

    report += `📍 الموقع: ${location}\n`;
    report += `💰 الإيرادات الشهرية: ${revenue} جنيه\n`;
    report += `💸 المصاريف الشهرية: ${expenses} جنيه\n`;
    report += `📈 الربح/الخسارة: ${profit > 0 ? 'ربح' : 'خسارة'} مقدارها ${Math.abs(profit)} جنيه\n\n`;

    report += `👥 عدد الموظفين: ${employees}\n`;
    report += `🚶‍♂️ متوسط الغياب اليومي: ${avgAbsent} (${absenceRate}%)\n`;
    report += `🏭 إجمالي الإنتاج: ${production}\n`;
    report += `⚙️ إنتاجية الموظف الحاضر: ${productivity} وحدة/موظف\n\n`;

    if(clientsCount !== null){
      report += `👨‍💼 عدد العملاء: ${clientsCount}\n\n`;
    }

    // إضافة تحليل SWOT
    report += `📋 تحليل SWOT:\n`;

    if(strengths.length) report += `✔️ نقاط القوة:\n - ${strengths.join('\n - ')}\n`;
    if(weaknesses.length) report += `⚠️ نقاط الضعف:\n - ${weaknesses.join('\n - ')}\n`;
    if(opportunities.length) report += `🌟 الفرص:\n - ${opportunities.join('\n - ')}\n`;
    if(threats.length) report += `🚨 التهديدات:\n - ${threats.join('\n - ')}\n`;

    document.getElementById('result').innerText = report;

    // رسم بياني للمؤشرات الأساسية
    google.charts.setOnLoadCallback(drawChart);

    function drawChart() {
      var data = google.visualization.arrayToDataTable([
        ['المؤشر', 'القيمة', { role: 'style' }],
        ['الإيرادات', revenue, '#4CAF50'],
        ['المصاريف', expenses, '#f44336'],
        ['عدد الموظفين', employees, '#2196F3'],
        ['الإنتاجية', parseFloat(productivity), '#FFC107'],
        ['نسبة الغياب', parseFloat(absenceRate), '#9E9E9E']
      ]);

      var options = {
        title: 'مؤشرات أداء الشركة',
        legend: { position: 'none' },
        vAxis: { minValue: 0 },
        chartArea: {width: '70%', height: '70%'}
      };

      var chart = new google.visualization.ColumnChart(document.getElementById('chart_div'));
      chart.draw(data, options);
    }

    // عرض خريطة Google Maps بموقع الشركة ونقاط نموذجية للمنافسين
    initMap(location);

  });

  function initMap(locationName) {
    var geocoder = new google.maps.Geocoder();
    var mapDiv = document.getElementById('map');
    mapDiv.innerHTML = 'جاري تحميل الخريطة...';

    geocoder.geocode( { 'address': locationName}, function(results, status) {
      if (status === 'OK') {
        var map = new google.maps.Map(mapDiv, {
          zoom: 12,
          center: results[0].geometry.location
        });

        // علامة على موقع الشركة
        var marker = new google.maps.Marker({
          map: map,
          position: results[0].geometry.location,
          title: 'موقع شركتك'
        });

        // نقاط منافسين نموذجية (مواقع وهمية قريبة)
        var competitors = [
          {lat: results[0].geometry.location.lat() + 0.01, lng: results[0].geometry.location.lng() + 0.01, title: 'منافس 1'},
          {lat: results[0].geometry.location.lat() - 0.008, lng: results[0].geometry.location.lng() + 0.012, title: 'منافس 2'},
          {lat: results[0].geometry.location.lat() + 0.012, lng: results[0].geometry.location.lng() - 0.015, title: 'منافس 3'}
        ];

        competitors.forEach(function(c){
          new google.maps.Marker({
            map: map,
            position: {lat: c.lat, lng: c.lng},
            icon: 'http://maps.google.com/mapfiles/ms/icons/red-dot.png',
            title: c.title
          });
        });

        mapDiv.innerHTML = '';
      } else {
        mapDiv.innerHTML = 'تعذر تحميل الخريطة: ' + status;
      }
    });
  }
</script>

</body>
</html>
