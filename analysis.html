<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<title>تحليل شامل لشركتك - رواء</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  /* تصميم عصري متجاوب */
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #f9fbfd;
    margin: 0; padding: 20px;
    color: #222;
  }
  h1 {
    text-align: center;
    color: #1a73e8;
    margin-bottom: 30px;
    font-weight: 700;
  }
  form {
    max-width: 720px;
    margin: auto;
    background: white;
    padding: 25px 30px;
    border-radius: 12px;
    box-shadow: 0 12px 30px rgba(26,115,232,0.15);
  }
  label {
    display: block;
    margin-top: 20px;
    font-weight: 600;
    color: #444;
  }
  input, select {
    margin-top: 8px;
    width: 100%;
    padding: 12px 14px;
    border: 1.8px solid #cbd5e1;
    border-radius: 8px;
    font-size: 1rem;
    transition: border-color 0.3s ease;
  }
  input:focus, select:focus {
    border-color: #1a73e8;
    outline: none;
  }
  select[multiple] {
    height: 130px;
  }
  .tooltip {
    margin-right: 6px;
    cursor: help;
    color: #1a73e8;
    font-weight: 700;
  }
  button {
    margin-top: 30px;
    width: 100%;
    padding: 14px 0;
    font-size: 1.15rem;
    font-weight: 700;
    color: white;
    background: #1a73e8;
    border: none;
    border-radius: 12px;
    cursor: pointer;
    box-shadow: 0 6px 12px rgba(26,115,232,0.35);
    transition: background-color 0.3s ease;
  }
  button:hover {
    background: #155ab6;
  }
  .error {
    color: #e53935;
    font-size: 0.9rem;
    margin-top: 5px;
  }
  #result {
    max-width: 720px;
    margin: 40px auto 0;
    background: #e8f0fe;
    border-radius: 12px;
    padding: 25px 30px;
    white-space: pre-line;
    color: #1a237e;
    font-weight: 600;
    box-shadow: 0 6px 20px rgba(26,115,232,0.2);
  }
  #charts_container {
    max-width: 720px;
    margin: 40px auto 0;
    display: flex;
    justify-content: space-around;
    flex-wrap: wrap;
    gap: 40px;
  }
  #chart_div, #pie_chart_div {
    width: 340px;
    height: 320px;
  }
</style>
</head>
<body>

<h1>تحليل شامل لأداء شركتك مع خطة عمل مقترحة</h1>

<form id="analysisForm" novalidate>

  <label><span class="tooltip" title="اسم شركتك الرسمي">ℹ️</span>اسم الشركة</label>
  <input type="text" id="companyName" required placeholder="مثلاً: رواء للاستشارات">
  <div id="error-companyName" class="error"></div>

  <label><span class="tooltip" title="إجمالي الإيرادات الشهرية">ℹ️</span>الإيرادات الشهرية</label>
  <input type="number" id="revenue" min="0" required placeholder="مثلاً: 150000">
  <div id="error-revenue" class="error"></div>

  <label><span class="tooltip" title="إجمالي المصاريف الشهرية">ℹ️</span>المصاريف الشهرية</label>
  <input type="number" id="expenses" min="0" required placeholder="مثلاً: 120000">
  <div id="error-expenses" class="error"></div>

  <label><span class="tooltip" title="عدد موظفي شركتك">ℹ️</span>عدد الموظفين</label>
  <input type="number" id="employees" min="1" required placeholder="مثلاً: 25">
  <div id="error-employees" class="error"></div>

  <label><span class="tooltip" title="متوسط عدد الغياب اليومي">ℹ️</span>متوسط عدد الموظفين الغائبين يوميًا</label>
  <input type="number" id="avgAbsent" min="0" required placeholder="مثلاً: 3">
  <div id="error-avgAbsent" class="error"></div>

  <label><span class="tooltip" title="كمية الإنتاج الشهري">ℹ️</span>إجمالي الإنتاج الشهري (وحدات أو خدمات)</label>
  <input type="number" id="production" min="0" required placeholder="مثلاً: 500">
  <div id="error-production" class="error"></div>

  <label><span class="tooltip" title="عدد العملاء (اختياري)">ℹ️</span>عدد العملاء (اختياري)</label>
  <input type="number" id="clientsCount" min="0" placeholder="مثلاً: 200">

  <label><span class="tooltip" title="اختر نقاط القوة">ℹ️</span>نقاط القوة (اختر ما ينطبق)</label>
  <select id="strengths" multiple>
    <option value="خبرة عالية في الموارد البشرية">خبرة عالية في الموارد البشرية</option>
    <option value="علاقات قوية مع العملاء">علاقات قوية مع العملاء</option>
    <option value="خدمات تحليل بيانات متقدمة">خدمات تحليل بيانات متقدمة</option>
    <option value="تواجد في السوق لفترة طويلة">تواجد في السوق لفترة طويلة</option>
  </select>

  <label><span class="tooltip" title="اختر نقاط الضعف">ℹ️</span>نقاط الضعف (اختر ما ينطبق)</label>
  <select id="weaknesses" multiple>
    <option value="ضعف في التسويق الرقمي">ضعف في التسويق الرقمي</option>
    <option value="نقص في التدريب للموظفين">نقص في التدريب للموظفين</option>
    <option value="اعتماد عالي على موظفين محددين">اعتماد عالي على موظفين محددين</option>
    <option value="موارد مالية محدودة">موارد مالية محدودة</option>
  </select>

  <label><span class="tooltip" title="اختر الفرص المتاحة">ℹ️</span>الفرص (اختر ما ينطبق)</label>
  <select id="opportunities" multiple>
    <option value="زيادة الطلب على خدمات الموارد البشرية">زيادة الطلب على خدمات الموارد البشرية</option>
    <option value="توسع السوق الرقمي">توسع السوق الرقمي</option>
    <option value="تطوير تقنيات تحليل البيانات">تطوير تقنيات تحليل البيانات</option>
    <option value="شراكات استراتيجية جديدة">شراكات استراتيجية جديدة</option>
  </select>

  <label><span class="tooltip" title="اختر التهديدات التي تواجهها">ℹ️</span>التهديدات (اختر ما ينطبق)</label>
  <select id="threats" multiple>
    <option value="منافسة شديدة في السوق">منافسة شديدة في السوق</option>
    <option value="تغيرات في القوانين">تغيرات في القوانين</option>
    <option value="تراجع في الاقتصاد">تراجع في الاقتصاد</option>
    <option value="صعوبة في جذب المواهب">صعوبة في جذب المواهب</option>
  </select>

  <button type="submit">ابدأ التحليل</button>
</form>

<div id="result"></div>

<div id="charts_container">
  <div id="chart_div"></div>
  <div id="pie_chart_div"></div>
</div>

<!-- Google Charts -->
<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

<script>
  google.charts.load('current', {'packages':['corechart']});
  google.charts.setOnLoadCallback(() => {});

  const form = document.getElementById('analysisForm');
  const resultDiv = document.getElementById('result');

  function clearErrors() {
    ['companyName','revenue','expenses','employees','avgAbsent','production'].forEach(id => {
      document.getElementById('error-' + id).innerText = '';
    });
  }

  function validate() {
    clearErrors();
    let valid = true;
    const companyName = document.getElementById('companyName').value.trim();
    const revenue = +document.getElementById('revenue').value;
    const expenses = +document.getElementById('expenses').value;
    const employees = +document.getElementById('employees').value;
    const avgAbsent = +document.getElementById('avgAbsent').value;
    const production = +document.getElementById('production').value;

    if(companyName === '') {
      document.getElementById('error-companyName').innerText = 'يرجى إدخال اسم الشركة';
      valid = false;
    }
    if(isNaN(revenue) || revenue < 0) {
      document.getElementById('error-revenue').innerText = 'يرجى إدخال إيرادات صحيحة (0 أو أكثر)';
      valid = false;
    }
    if(isNaN(expenses) || expenses < 0) {
      document.getElementById('error-expenses').innerText = 'يرجى إدخال مصاريف صحيحة (0 أو أكثر)';
      valid = false;
    }
    if(isNaN(employees) || employees < 1) {
      document.getElementById('error-employees').innerText = 'يرجى إدخال عدد موظفين صحيح (1 أو أكثر)';
      valid = false;
    }
    if(isNaN(avgAbsent) || avgAbsent < 0 || avgAbsent > employees) {
      document.getElementById('error-avgAbsent').innerText = 'يرجى إدخال غياب صحيح (0 أو أكثر وأقل من عدد الموظفين)';
      valid = false;
    }
    if(isNaN(production) || production < 0) {
      document.getElementById('error-production').innerText = 'يرجى إدخال إنتاج صحيح (0 أو أكثر)';
      valid = false;
    }
    return valid;
  }

  function getSelectedOptions(id) {
    const select = document.getElementById(id);
    return Array.from(select.selectedOptions).map(opt => opt.value);
  }

  form.addEventListener('submit', e => {
    e.preventDefault();
    if(!validate()) {
      resultDiv.innerText = '';
      return;
    }

    // جلب القيم
    const name = document.getElementById('companyName').value.trim();
    const revenue = +document.getElementById('revenue').value;
    const expenses = +document.getElementById('expenses').value;
    const employees = +document.getElementById('employees').value;
    const avgAbsent = +document.getElementById('avgAbsent').value;
    const production = +document.getElementById('production').value;
    const clientsCountVal = document.getElementById('clientsCount').value;
    const clientsCount = clientsCountVal ? +clientsCountVal : null;
    const strengths = getSelectedOptions('strengths');
    const weaknesses = getSelectedOptions('weaknesses');
    const opportunities = getSelectedOptions('opportunities');
    const threats = getSelectedOptions('threats');

    // حسابات
    const absenceRate = ((avgAbsent / employees) * 100).toFixed(2);
    const profit = revenue - expenses;
    const presentEmployees = employees - avgAbsent;
    const productivity = presentEmployees > 0 ? (production / presentEmployees).toFixed(2) : 0;
    const profitMargin = revenue > 0 ? ((profit / revenue) * 100).toFixed(2) : 0;
    const expenseRatio = revenue > 0 ? ((expenses / revenue) * 100).toFixed(2) : 0;
    const breakEven = expenses === 0 ? 'غير محدد' : (expenses / (profitMargin / 100)).toFixed(2);

    // مؤشر الأداء KPI
    let kpi = 50;
    if(profit > 0) kpi += 25; else kpi -= 15;
    if(productivity >= 10) kpi += 20; else if(productivity >= 5) kpi += 10; else kpi -= 10;
    if(absenceRate <= 5) kpi += 10; else if(absenceRate <= 10) kpi += 5; else kpi -= 20;
    if(kpi > 100) kpi = 100;
    if(kpi < 0) kpi = 0;

    // تقرير نصي
    let report = `📊 تقرير أداء شركة: ${name}\n\n`;
    report += `💰 الإيرادات الشهرية: ${revenue}\n`;
    report += `💸 المصاريف الشهرية: ${expenses}\n`;
    report += `📈 الربح/الخسارة: ${profit > 0 ? 'ربح' : 'خسارة'} بمقدار ${Math.abs(profit)}\n`;
    report += `🔹 هامش الربح: ${profitMargin}%\n`;
    report += `🔹 نسبة المصاريف للإيرادات: ${expenseRatio}%\n\n`;
    report += `👥 عدد الموظفين: ${employees}\n`;
    report += `🚶‍♂️ متوسط الغياب اليومي: ${avgAbsent} (${absenceRate}%)\n`;
    report += `🏭 إجمالي الإنتاج: ${production}\n`;
    report += `⚙️ إنتاجية الموظف الحاضر: ${productivity} وحدة/موظف\n`;
    report += `📉 نقطة التعادل (Break-even): ${breakEven}\n\n`;
    if(clientsCount !== null) {
      report += `👨‍💼 عدد العملاء: ${clientsCount}\n\n`;
    }
    report += `📋 تحليل SWOT:\n`;
    if(strengths.length) report += `✔️ نقاط القوة:\n - ${strengths.join('\n - ')}\n`;
    if(weaknesses.length) report += `❌ نقاط الضعف:\n - ${weaknesses.join('\n - ')}\n`;
    if(opportunities.length) report += `🌟 الفرص:\n - ${opportunities.join('\n - ')}\n`;
    if(threats.length) report += `⚠️ التهديدات:\n - ${threats.join('\n - ')}\n`;

    // خطة العمل المقترحة بناء على KPI
    report += `\n📝 خطة العمل المقترحة:\n`;
    if(kpi >= 80) {
      report += "أداء ممتاز، استمر في تحسين نقاط القوة وتعزيز استراتيجياتك الحالية.\n";
    } else if(kpi >= 60) {
      report += "أداء جيد، لكن يُنصح بمراجعة إدارة المصاريف وتحسين إنتاجية الموظفين.\n";
    } else {
      report += "الأداء يحتاج لتحسينات كبيرة، ركز على تقليل المصاريف، تحسين بيئة العمل، وتطوير مهارات الموظفين.\n";
    }

    // عرض التقرير
    resultDiv.innerText = report;

    // رسم الرسوم البيانية
    google.charts.setOnLoadCallback(() => {
      drawBarChart(profitMargin, expenseRatio, absenceRate, productivity, kpi);
      drawPieChart(strengths.length, weaknesses.length, opportunities.length, threats.length);
    });
  });

  // رسم بياني عمودي لمؤشرات مالية وأداء
  function drawBarChart(profitMargin, expenseRatio, absenceRate, productivity, kpi) {
    const data = google.visualization.arrayToDataTable([
      ['المؤشر', 'القيمة'],
      ['هامش الربح %', parseFloat(profitMargin)],
      ['نسبة المصاريف %', parseFloat(expenseRatio)],
      ['معدل الغياب %', parseFloat(absenceRate)],
      ['إنتاجية الموظف', parseFloat(productivity)],
      ['مؤشر الأداء KPI', parseFloat(kpi)],
    ]);

    const options = {
      title: 'مؤشرات الأداء المالي والإداري',
      legend: { position: 'none' },
      colors: ['#1a73e8'],
      vAxis: { minValue: 0 },
      chartArea: {width: '70%', height: '70%'},
      fontName: 'Segoe UI',
    };

    const chart = new google.visualization.ColumnChart(document.getElementById('chart_div'));
    chart.draw(data, options);
  }

  // رسم بياني دائري لتحليل SWOT
  function drawPieChart(strengthsCount, weaknessesCount, opportunitiesCount, threatsCount) {
    const data = google.visualization.arrayToDataTable([
      ['العنصر', 'العدد'],
      ['نقاط القوة', strengthsCount],
      ['نقاط الضعف', weaknessesCount],
      ['الفرص', opportunitiesCount],
      ['التهديدات', threatsCount],
    ]);

    const options = {
      title: 'تحليل SWOT',
      pieHole: 0.4,
      colors: ['#4caf50', '#f44336', '#ff9800', '#9c27b0'],
      fontName: 'Segoe UI',
      chartArea: {width: '80%', height: '80%'},
    };

    const chart = new google.visualization.PieChart(document.get
